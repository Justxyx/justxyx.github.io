---
title: C++primer-p11 å…³è”å®¹å™¨
author: xyx
date: 2021-11-29 13:33:00 +0800
categories: [C++, cpp-base]
tags:
math: true
---

# ç¬¬åä¸€ç«  å…³è”å®¹å™¨

- å…³è”å®¹å™¨å’Œé¡ºåºå®¹å™¨çš„ä¸åŒï¼šå…³è”å®¹å™¨ä¸­çš„å…ƒç´ æ—¶æŒ‰ç…§**å…³é”®å­—**æ¥ä¿å­˜å’Œè®¿é—®çš„ã€‚
- å…³è”å®¹å™¨æ”¯æŒé€šè¿‡å…³é”®å­—æ¥é«˜æ•ˆåœ°æŸ¥æ‰¾å’Œè¯»å–å…ƒç´ ï¼ŒåŸºæœ¬çš„å…³è”å®¹å™¨ç±»å‹æ˜¯ `map`å’Œ `set`ã€‚

**å…³è”å®¹å™¨ç±»å‹**ï¼š

| å®¹å™¨ç±»å‹ | è§£é‡Š |
|-----|-----|
| æŒ‰é¡ºåºå­˜å‚¨ |  |
| `map` | å…³é”®æ•°ç»„ï¼šä¿å­˜`å…³é”®å­—-å€¼`å¯¹ |
| `set` | å…³é”®å­—å³å€¼ï¼Œå³åªä¿å­˜å…³é”®å­—çš„å®¹å™¨ |
| `multimap` | æ”¯æŒåŒä¸€ä¸ªé”®å¤šæ¬¡å‡ºç°çš„`map` |
| `multiset` | æ”¯æŒåŒä¸€ä¸ªé”®å¤šæ¬¡å‡ºç°çš„`set` |
| æ— åºé›†åˆ |  |
| `unordered_map` | ç”¨å“ˆå¸Œå‡½æ•°ç»„ç»‡çš„`map` |
| `unordered_set` | ç”¨å“ˆå¸Œå‡½æ•°ç»„ç»‡çš„`set` |
| `unordered_multimap` | å“ˆå¸Œç»„ç»‡çš„`map`ï¼Œå…³é”®å­—å¯ä»¥é‡å¤å‡ºç° |
| `unordered_multiset` | å“ˆå¸Œç»„ç»‡çš„`set`ï¼Œå…³é”®å­—å¯ä»¥é‡å¤å‡ºç° |

## å…³è”å®¹å™¨æ¦‚è¿°

### å®šä¹‰å…³è”å®¹å™¨

- éœ€è¦æŒ‡å®šå…ƒç´ ç±»å‹ã€‚
- åˆ—è¡¨åˆå§‹åŒ–ï¼š
  - `map`ï¼š`map<string, int> word_count = {{"a", 1}, {"b", 2}};`
  - `set`ï¼š`set<string> exclude = {"the", "a"};`

```c
void test02(){
    vector<int> v;
    for (vector<int>::size_type i= 0;  i<10 ; ++i) {
        v.push_back(i);
        v.push_back(i);
    }
    set<int> iset(v.begin(),v.end());
    multiset<int> miset(v.begin(),v.end());
    
    cout << v.size() << endl;     // 20
    cout << iset.size() << endl;    // 10
    cout << miset.size() << endl;   // 20
}
```


### å…³é”®å­—ç±»å‹çš„è¦æ±‚

- å¯¹äºæœ‰åºå®¹å™¨ï¼Œå…³é”®å­—ç±»å‹å¿…é¡»å®šä¹‰å…ƒç´ æ¯”è¾ƒçš„æ–¹æ³•ã€‚é»˜è®¤æ˜¯`<`ã€‚
- å¦‚æœæƒ³ä¼ é€’ä¸€ä¸ªæ¯”è¾ƒçš„å‡½æ•°ï¼Œå¯ä»¥è¿™æ ·å®šä¹‰ï¼š`multiset<Sales_data, decltype(compareIsbn)*> bookstore(compareIsbn);`

```c
void test03(){
    multiset<int> s = {1,4,2,3,5,6,2};
    for (const auto &item : s)
        cout << item << " " ;    // 1 2 2 3 4 5 6  set ä¸ºæœ‰åºé›†åˆ
    multimap<int,int> m = {
            {1,3},
            {2,4},
            {5,3},
            {3,4}
    };
    for (const auto &item : m){
        cout << item.first << ":" << item.second << " ";   // 1:3 2:4 3:4 5:3   map ä¹Ÿæ˜¯æŒ‰ç…§å…³é”®å­—æ’åº
    }
}
```

### pair

- åœ¨`utility`å¤´æ–‡ä»¶ä¸­å®šä¹‰ã€‚
- ä¸€ä¸ª`pair`ä¿å­˜ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼Œä¸¤ä¸ªç±»å‹ä¸è¦æ±‚ä¸€æ ·ã€‚

**pairçš„æ“ä½œ**ï¼š

| æ“ä½œ | è§£é‡Š |
|-----|-----|
| `pair<T1, T2> p;` | `p`æ˜¯ä¸€ä¸ª`pair`ï¼Œä¸¤ä¸ªç±»å‹åˆ†åˆ«æ˜¯`T1`å’Œ`T2`çš„æˆå‘˜éƒ½è¿›è¡Œäº†å€¼åˆå§‹åŒ–ã€‚ |
| `pair<T1, T2> p(v1, v2);` | `first`å’Œ`second`åˆ†åˆ«ç”¨`v1`å’Œ`v2`è¿›è¡Œåˆå§‹åŒ–ã€‚ |
| `pair<T1, T2>p = {v1, v2};` | ç­‰ä»·äº`p(v1, v2) |
| `make_pair(v1, v2);` | `pair`çš„ç±»å‹ä»`v1`å’Œ`v2`çš„ç±»å‹æ¨æ–­å‡ºæ¥ã€‚ |
| `p.first` | è¿”å›`p`çš„åä¸º`first`çš„æ•°æ®æˆå‘˜ã€‚ |
| `p.second` | è¿”å›`p`çš„åä¸º`second`çš„æ•°æ®æˆå‘˜ã€‚ |
| `p1 relop p2` | è¿ç®—å…³ç³»ç¬¦æŒ‰å­—å…¸åºå®šä¹‰ã€‚ |
| `p1 == p2` | å¿…é¡»ä¸¤å¯¹å…ƒç´ ä¸¤ä¸¤ç›¸ç­‰ |
| `p1 != p2` | åŒä¸Š |

**pairä¿å­˜çš„æ˜¯ä¸€å¯¹key valueï¼Œè€Œmapå¯ä»¥ä¿å­˜å¤šå¯¹key valueã€‚**

```c
pair<string,int> process(vector<string> &v){
    if ( ! v.empty())
        return {v.back(),v.back().size()};   // åˆ—è¡¨åˆå§‹åŒ–
    else
        return pair<string,int>();      // éšå¼æ„é€ è¿”å›å€¼
}

void test04(){
    vector<string> v = {"hello" , "hey"};
    pair<string,int> p =  process(v);
    cout << p.first << "  " << p.second << endl;
}
```

## å…³è”å®¹å™¨æ“ä½œ

**å…³è”å®¹å™¨é¢å¤–çš„ç±»å‹åˆ«å**ï¼š

| ç±»å‹åˆ«å | è§£é‡Š |
|-----|-----|
| `key_type` | æ­¤å®¹å™¨ç±»å‹çš„å…³é”®å­—ç±»å‹ |
| `mapped_type` | æ¯ä¸ªå…³é”®å­—å…³è”çš„ç±»å‹ï¼Œåªé€‚ç”¨äº`map` |
| `value_type` | å¯¹äº`map`ï¼Œæ˜¯`pair<const key_type, mapped_type>`; å¯¹äº`set`ï¼Œå’Œ`key_type`ç›¸åŒã€‚ |

### å…³è”å®¹å™¨è¿­ä»£å™¨

- è§£å¼•ç”¨ä¸€ä¸ªå…³è”å®¹å™¨è¿­ä»£å™¨æ—¶ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹ä¸ºå®¹å™¨çš„`value_type`çš„å€¼çš„å¼•ç”¨ã€‚
- `set`çš„è¿­ä»£å™¨æ˜¯`const`çš„ã€‚
- éå†å…³è”å®¹å™¨ï¼šä½¿ç”¨`begin`å’Œ`end`ï¼Œéå†`map`ã€`multimap`ã€`set`ã€`multiset`æ—¶ï¼Œè¿­ä»£å™¨æŒ‰**å…³é”®å­—å‡åº**éå†å…ƒç´ ã€‚

```c

void test05(){
    map<int,string> iMap = {
            {1, "jay"},
            {2,"chou"},
            {3,"may"}
    };
    set<int> iSet = {1,3,2,5,4,5};

    auto c = iMap.cbegin();
    while (c != iMap.cend()){
        cout << c->first << endl;
        ++ c;
    }
}
```

### æ·»åŠ å…ƒç´ 

**å…³è”å®¹å™¨`insert`æ“ä½œ**ï¼š

| `insert`æ“ä½œ | å…³è”å®¹å™¨ |
|-----|-----|
| `c.insert(v)`  `c.emplace(args)` | `v`æ˜¯`value_type`ç±»å‹çš„å¯¹è±¡ï¼›`args`ç”¨æ¥æ„é€ ä¸€ä¸ªå…ƒç´ ã€‚ å¯¹äº`map`å’Œ`set`ï¼Œåªæœ‰å…ƒç´ çš„å…³é”®å­—ä¸å­˜åœ¨`c`ä¸­æ‰æ’å…¥æˆ–æ„é€ å…ƒç´ ã€‚å‡½æ•°è¿”å›ä¸€ä¸ª`pair`ï¼ŒåŒ…å«ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘å…·æœ‰æŒ‡å®šå…³é”®å­—çš„å…ƒç´ ï¼Œä»¥åŠä¸€ä¸ªæŒ‡ç¤ºæ’å…¥æ˜¯å¦æˆåŠŸçš„`bool`å€¼ã€‚å¯¹äº`multimap`å’Œ`multiset`åˆ™ä¼šæ’å…¥èŒƒå›´ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚|
| `c.insert(b, e)` `c.insert(il)` | `b`å’Œ`e`æ˜¯è¿­ä»£å™¨ï¼Œè¡¨ç¤ºä¸€ä¸ª`c::value_type`ç±»å‹å€¼çš„èŒƒå›´ï¼›`il`æ˜¯è¿™ç§å€¼çš„èŠ±æ‹¬å·åˆ—è¡¨ã€‚å‡½æ•°è¿”å›`void`ã€‚å¯¹äº `map`å’Œ`set`ï¼Œåªæ’å…¥å…³é”®å­—ä¸åœ¨`c`ä¸­çš„å…ƒç´ ã€‚ |
| `c.insert(p, v)`  `c.emplace(p, args)` | ç±»ä¼¼`insert(v)`ï¼Œä½†å°†è¿­ä»£å™¨`p`ä½œä¸ºä¸€ä¸ªæç¤ºï¼ŒæŒ‡å‡ºä»å“ªé‡Œå¼€å§‹æœç´¢æ–°å…ƒç´ åº”è¯¥å­˜å‚¨çš„ä½ç½®ã€‚è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘å…·æœ‰ç»™å®šå…³é”®å­—çš„å…ƒç´ ã€‚ |

å‘`map`æ·»åŠ å…ƒç´ ï¼š
- `word_count.insert({word, 1});`
- `word_count.insert(make_pair(word, 1));`
- `word_count.insert(pair<string, size_t>(word, 1));`
- `word_count.insert(map<string, size_t>::value_type (word, 1));`

### åˆ é™¤å…ƒç´ 

**ä»å…³è”å®¹å™¨ä¸­åˆ é™¤å…ƒç´ **ï¼š

| æ“ä½œ | è§£é‡Š |
|-----|-----|
| `c.erase(k)` | ä»`c`ä¸­åˆ é™¤æ¯ä¸ªå…³é”®å­—ä¸º`k`çš„å…ƒç´ ã€‚è¿”å›ä¸€ä¸ª`size_type`å€¼ï¼ŒæŒ‡å‡ºåˆ é™¤çš„å…ƒç´ çš„æ•°é‡ã€‚ |
| `c.erase(p)` | ä»`c`ä¸­åˆ é™¤è¿­ä»£å™¨`p`æŒ‡å®šçš„å…ƒç´ ã€‚`p`å¿…é¡»æŒ‡å‘`c`ä¸­ä¸€ä¸ªçœŸå®å…ƒç´ ï¼Œä¸èƒ½ç­‰äº`c.end()`ã€‚è¿”å›ä¸€ä¸ªæŒ‡å‘`p`ä¹‹åå…ƒç´ çš„è¿­ä»£å™¨ï¼Œè‹¥`p`æŒ‡å‘`c`ä¸­çš„å°¾å…ƒç´ ï¼Œåˆ™è¿”å›`c.end()` |
| `c.erase(b, e)` | åˆ é™¤è¿­ä»£å™¨å¯¹`b`å’Œ`e`æ‰€è¡¨ç¤ºèŒƒå›´ä¸­çš„å…ƒç´ ã€‚è¿”å›`e`ã€‚ |

```c
void test07(){
    map<int,string> iMap = {
            {1, "jay"},
            {2,"chou"},
            {3,"may"}
    };
    set<int> iSet = {1,3,2,5,4,5};
    auto b =  iMap.erase(1);   // bä¸ºåˆ é™¤æ•°é‡
    auto p = iMap.begin();
    iMap.erase(p);      // åˆ é™¤è¿­ä»£å™¨ä¸ºpçš„å…ƒç´  è¿­ä»£å™¨å¿…é¡»çœŸå®å­˜åœ¨
    cout << b << endl;
}
```

### ä¸‹æ ‡æ“ä½œ

**`map`å’Œ`unordered_map`çš„ä¸‹æ ‡æ“ä½œ**ï¼š

| æ“ä½œ | è§£é‡Š |
|-----|-----|
| `c[k]` | è¿”å›å…³é”®å­—ä¸º`k`çš„å…ƒç´ ï¼›å¦‚æœ`k`ä¸åœ¨`c`ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªå…³é”®å­—ä¸º`k`çš„å…ƒç´ ï¼Œå¯¹å…¶å€¼åˆå§‹åŒ–ã€‚ |
| `c.at(k)` | è®¿é—®å…³é”®å­—ä¸º`k`çš„å…ƒç´ ï¼Œå¸¦å‚æ•°æ£€æŸ¥ï¼›è‹¥`k`ä¸å­˜åœ¨åœ¨`c`ä¸­ï¼ŒæŠ›å‡ºä¸€ä¸ª`out_of_range`å¼‚å¸¸ã€‚ |

### æŸ¥æ‰¾å…ƒç´ 

**åœ¨ä¸€ä¸ªå…³è”å®¹å™¨ä¸­æŸ¥æ‰¾å…ƒç´ **:

| æ“ä½œ | è§£é‡Š |
|-----|-----|
| `c.find(k)` | è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—ä¸º`k`çš„å…ƒç´ ï¼Œè‹¥`k`ä¸åœ¨å®¹å™¨ä¸­ï¼Œåˆ™è¿”å›å°¾åè¿­ä»£å™¨ |
| `c.count(k)` | è¿”å›å…³é”®å­—ç­‰äº`k`çš„å…ƒç´ çš„æ•°é‡ã€‚å¯¹äºä¸å…è®¸é‡å¤å…³é”®å­—çš„å®¹å™¨ï¼Œè¿”å›å€¼æ°¸è¿œæ˜¯0æˆ–1ã€‚ |
| `c.lower_bound(k)` | è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—**ä¸å°äº**`k`çš„å…ƒç´ ã€‚ |
| `c.upper_bound(k)` | è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªå…³é”®å­—**å¤§äº**`k`çš„å…ƒç´ ã€‚ |
| `c.equal_range(k)` | è¿”å›ä¸€ä¸ªè¿­ä»£å™¨`pair`ï¼Œè¡¨ç¤ºå…³é”®å­—ç­‰äº`k`çš„å…ƒç´ çš„èŒƒå›´ã€‚è‹¥`k`ä¸å­˜åœ¨ï¼Œ`pair`çš„ä¸¤ä¸ªæˆå‘˜å‡ç­‰äº`c.end()`ã€‚ |

- `lower_bound`å’Œ`upper_bound`ä¸é€‚ç”¨äºæ— åºå®¹å™¨ã€‚
- ä¸‹æ ‡å’Œ`at`æ“ä½œåªé€‚ç”¨äºé`const`çš„`map`å’Œ`unordered_map`ã€‚

```c
void test09(){
    map<int,string> iMap = {
            {1, "jay"},
            {2,"chou"},
            {3,"may"}
    };
    if ( iMap.find(1) == iMap.end())
        cout << " has not found" << endl;
    else{
        auto p = iMap.find(1);   // è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¦‚æœæ²¡æœ‰è¯¥å…ƒç´  åˆ™ç›´æ¥è¿”å›endè¿­ä»£å™¨ã€‚
        cout << p->second << endl;
    }
}
```

```c
// å¯¹äºé‡å¤å…ƒç´ çš„æŸ¥æ‰¾
void test10(){
    multimap<int,string> iMap = {
            {1, "jay"},
            {1,"chou"},
            {1,"may"}
    };
    auto count = iMap.count(1);
    auto item = iMap.find(1);
//    1. æ–¹æ³•ä¸€
    while(count){
        cout << item ->second << endl;
        -- count ;
        ++ item;
    }
//    2.æ–¹æ³•2
    for(auto begin = iMap.lower_bound(1),end = iMap.upper_bound(1);begin!=end;begin++)
        cout << begin->second << endl;
}
```

## æ— åºå®¹å™¨

- æœ‰åºå®¹å™¨ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æ¥ç»„ç»‡å…ƒç´ ï¼›æ— åºå®¹å™¨ä½¿ç”¨å“ˆå¸Œå‡½æ•°å’Œå…³é”®å­—ç±»å‹çš„`==`è¿ç®—ç¬¦ã€‚
- ç†è®ºä¸Šå“ˆå¸ŒæŠ€æœ¯å¯ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚
- æ— åºå®¹å™¨åœ¨å­˜å‚¨ä¸Šç»„ç»‡ä¸ºä¸€ç»„æ¡¶(bucket)ï¼Œæ¯ä¸ªæ¡¶ä¿å­˜é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚æ— åºå®¹å™¨ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œå‡½æ•°å°†å…ƒç´ æ˜ å°„åˆ°æ¡¶ã€‚

**æ— åºå®¹å™¨ç®¡ç†æ“ä½œ**ï¼š

| æ“ä½œ | è§£é‡Š |
|-----|-----|
| **æ¡¶æ¥å£** |  |
| `c.bucket_count()` | æ­£åœ¨ä½¿ç”¨çš„æ¡¶çš„æ•°ç›® |
| `c.max_bucket_count()` | å®¹å™¨èƒ½å®¹çº³çš„æœ€å¤šçš„æ¡¶çš„æ•°ç›® |
| `c.bucket_size(n)` | ç¬¬`n`ä¸ªæ¡¶ä¸­æœ‰å¤šå°‘ä¸ªå…ƒç´  |
| `c.bucket(k)` | å…³é”®å­—ä¸º`k`çš„å…ƒç´ åœ¨å“ªä¸ªæ¡¶ä¸­ |
| **æ¡¶è¿­ä»£** |  |
| `local_iterator` | å¯ä»¥ç”¨æ¥è®¿é—®æ¡¶ä¸­å…ƒç´ çš„è¿­ä»£å™¨ç±»å‹ |
| `const_local_iterator` | æ¡¶è¿­ä»£å™¨çš„`const`ç‰ˆæœ¬ |
| `c.begin(n)`ï¼Œ`c.end(n)` | æ¡¶`n`çš„é¦–å…ƒç´ è¿­ä»£å™¨ |
| `c.cbegin(n)`ï¼Œ`c.cend(n)` | ä¸å‰ä¸¤ä¸ªå‡½æ•°ç±»ä¼¼ï¼Œä½†è¿”å›`const_local_iterator`ã€‚ |
| **å“ˆå¸Œç­–ç•¥** |  |
| `c.load_factor()` | æ¯ä¸ªæ¡¶çš„å¹³å‡å…ƒç´ æ•°é‡ï¼Œè¿”å›`float`å€¼ã€‚ |
| `c.max_load_factor()` | `c`è¯•å›¾ç»´æŠ¤çš„å¹³å‡æ¯”æ¡¶å¤§å°ï¼Œè¿”å›`float`å€¼ã€‚`c`ä¼šåœ¨éœ€è¦æ—¶æ·»åŠ æ–°çš„æ¡¶ï¼Œä»¥ä½¿å¾—`load_factor<=max_load_factor` |
| `c.rehash(n)` | é‡ç»„å­˜å‚¨ï¼Œä½¿å¾—`bucket_count>=n`ï¼Œä¸”`bucket_count>size/max_load_factor` |
| `c.reverse(n)` | é‡ç»„å­˜å‚¨ï¼Œä½¿å¾—`c`å¯ä»¥ä¿å­˜`n`ä¸ªå…ƒç´ ä¸”ä¸å¿…`rehash`ã€‚ |
