---
title: Linux高性能服务器编程--服务器编程规范
author: xyx
date: 2022-4-7 20:33:00 +0800
categories: [C++, linux-os]
tags: 
math: true
---

## 1. 日志函数 syslog

## 2. 用户信息

### UID 与 EUID

- 为什么引入EUID(有效用户id）？
    允许不同的用户以UID的权限运行改程序。**设置`set-user-id`字段，任何用户启动该程序，其有效用户就是该程序的所有者**

### demo 切换用户

```c
static bool switch_to_user( uid_t user_id, gid_t gp_id )
{
    if ( ( user_id == 0 ) && ( gp_id == 0 ) )
    {
        return false;
    }

    gid_t gid = getgid();
    uid_t uid = getuid();
    if ( ( ( gid != 0 ) || ( uid != 0 ) ) && ( ( gid != gp_id ) || ( uid != user_id ) ) )
    {
        return false;
    }

    if ( uid != 0 )
    {
        return true;
    }

    if ( ( setgid( gp_id ) < 0 ) || ( setuid( user_id ) < 0 ) )
    {
        return false;
    }

    return true;
}
```

## 3. 进程间的关系

- 进程组
    Linux 下每个进程都属于一个进程组，因此除了`PID`信息外，还有进程组ID `PGID`.
    
    ```c
    int setpgid(pid_t pid, pid_t pgid); // 设置pgid
    int gettpgid(pid_t pid, pid_t pgid); // 获得pgid
    ```

- 会话

    `pid_t setsid(void)` 用于创建一个会话，**该函数不能由进程组的首领进程调用**
    - 调用的进程会成为会话的首领。
    - PGID 就是调用进程的PID

- 用ps命令查看进程间关系

    命令： `ps -o pid,ppid,pgid,sid,comm | less`

    ```c
    PID  PPID  PGID   SID COMMAND
    824 24456   824 24456 ps
    825 24456   824 24456 less
    24456 24455 24456 24456 bash
    ```


## 4.系统资源限制

p120
```c
    int getrlimit(int resource, struct rlimit *rlim);
    int setrlimit(int resource, const struct rlimit *rlim);
```

## 5. 改变工作目录

`chdir()  // 改变工作目录`

## 6. 服务器后台化



